<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostrcoin Faucet</title>
    <script src="https://unpkg.com/nostr-tools@2.7.0/lib/nostr.bundle.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#1a1a1a;color:#f5f5f5;min-height:100vh;padding:20px}
        .container{max-width:600px;margin:40px auto;text-align:center}
        .header{text-align:center;margin-bottom:40px;padding:30px 0;border-bottom:2px solid #3a3a3a}
        .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:20px;border-bottom:2px solid #3a3a3a}
        .hamburger-btn{background:#2a2a2a;border:1px solid #444;color:#f5f5f5;padding:10px 14px;border-radius:8px;cursor:pointer;font-size:20px;line-height:1;transition:all .2s;display:flex;align-items:center;justify-content:center}
        .hamburger-btn:hover{background:#333;border-color:#32CD32}
        .join-nostr-btn{background:#f28500;color:#1a1a1a;border:1px solid #f28500;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:.5px;transition:all .2s}
        .join-nostr-btn:hover{background:#ff9500;border-color:#ff9500;transform:translateY(-2px)}
        .logo{font-size:42px;font-weight:700;color:#32CD32;margin-bottom:8px}
        .subtitle{color:#bbb;font-size:16px}
        .faucet-image{max-width:280px;width:100%;margin:30px auto;display:block;filter:drop-shadow(0 4px 20px rgba(0,0,0,0.5))}
        .card{background:#2a2a2a;border:1px solid #444;border-radius:12px;padding:30px;margin:30px 0}
        .button-primary{background:#32CD32;color:#1a1a1a;padding:15px 30px;border:none;border-radius:8px;font-weight:600;font-size:16px;cursor:pointer;margin-top:20px;text-transform:uppercase;letter-spacing:0.5px}
        .button-primary:hover{background:#28b428}
        .button-primary:disabled{background:#666;cursor:not-allowed}
        input{padding:12px;border-radius:8px;border:1px solid #444;background:#1a1a1a;color:#f5f5f5;width:100%;margin:20px 0;font-size:16px;font-family:monospace}
        .status{margin-top:20px;padding:12px;border-radius:8px;font-weight:bold}
        .success{background:#d4edda;color:#155724;border:1px solid #32CD32}
        .error{background:#f8d7da;color:#721c24;border:1px solid #ff6b6b}
        .footer-note{font-size:12px;color:#888;margin-top:40px}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;justify-content:center;align-items:center;padding:20px;z-index:50}
        .modal-overlay.active{display:flex}
        .modal{background:#2a2a2a;border:1px solid #444;border-radius:16px;padding:26px;max-width:380px;width:100%;position:relative}
        .modal-close{position:absolute;top:10px;right:14px;background:none;border:none;color:#999;font-size:20px;cursor:pointer}
        .modal-close:hover{color:#fff}
        .modal-link{display:block;padding:12px 16px;color:#f5f5f5;text-decoration:none;border-radius:8px;margin-bottom:8px;transition:all .2s;border:1px solid transparent}
        .modal-link:hover{background:#333;border-color:#32CD32;color:#32CD32}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <button class="hamburger-btn" onclick="toggleMenuModal(true)" aria-label="Menu">☰</button>
                <button class="join-nostr-btn" onclick="toggleJoinNostrModal(true)">Join Nostr</button>
            </div>
            <div class="logo">⚡ Nostrcoin Faucet</div>
            <div class="subtitle">Get 5 NSTC free • v0.1.0</div>
        </div>

        <!-- Classic Bitcoin Faucet Image -->
        <img src="faucet.png" alt="Classic red faucet pouring coins" class="faucet-image">

        <div class="card">
            <input type="text" id="npubInput" placeholder="npub1...">
            <button class="button-primary" id="claimBtn" onclick="claim()">Claim 5 NSTC</button>
            <div id="status"></div>
        </div>

        <p class="footer-note">
            Faucet operated by<br>
            npub1faucl9vfhuxm7g5k7eq4u2pxrxkxn04g39uhtv9jvjrfh6p4llhq7neccr
        </p>
    </div>

    <!-- Menu Modal -->
    <div id="menuModal" class="modal-overlay" aria-hidden="true">
        <div class="modal">
            <button class="modal-close" onclick="toggleMenuModal(false)" aria-label="Close">×</button>
            <h3>Menu</h3>
            <a href="https://saccoci.github.io/explorer.html" target="_blank" class="modal-link">Explorer</a>
            <a href="https://saccoci.github.io/wallet.html" target="_blank" class="modal-link">Wallet</a>
            <a href="https://saccoci.github.io/faucet.html" target="_blank" class="modal-link">Faucet</a>
            <a href="https://nostrcoin.boards.net" target="_blank" class="modal-link">Forum</a>
            <a href="https://github.com/saccoci" target="_blank" class="modal-link">GitHub</a>
        </div>
    </div>

    <!-- Join Nostr Modal (same as wallet/explorer) -->
    <div id="joinNostrModal" class="modal-overlay" aria-hidden="true">
        <div class="modal">
            <button class="modal-close" onclick="toggleJoinNostrModal(false)" aria-label="Close">×</button>
            <h3>What is Nostr?</h3>
            <p style="margin-top:12px;">
                Nostr is a simple, open protocol that powers decentralized social media and enables censorship-resistant communication.
                It uses public/private key pairs for identity — the same keys Nostrcoin uses for its blockchain (mining events and transfer events).
            </p>
            <p style="margin-top:12px;">
                To use Nostrcoin, you'll need a Nostr account and a signing extension (like Alby, nos2x, or others).
            </p>
            <ul style="margin-top:8px;margin-left:20px;line-height:1.8;">
                <li>Create a Nostr account</li>
                <li>Install a Nostr signing extension in your browser</li>
            </ul>
            <a href="https://nstart.me" target="_blank" class="join-nostr-btn" style="margin-top:16px;text-align:center;display:block;">Join Nostr</a>
        </div>
    </div>

    <script>
        const FAUCET_BACKEND = 'http://vm-182.lnvps.cloud:3000/';  // ← Change to your actual VPS domain

        function toggleMenuModal(show) {
            const modal = document.getElementById('menuModal');
            modal.classList.toggle('active', show);
            modal.setAttribute('aria-hidden', !show);
        }

        function toggleJoinNostrModal(show) {
            const modal = document.getElementById('joinNostrModal');
            modal.classList.toggle('active', show);
            modal.setAttribute('aria-hidden', !show);
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                toggleMenuModal(false);
                toggleJoinNostrModal(false);
            }
        });

        window.addEventListener('click', (e) => {
            if (e.target.id === 'menuModal') toggleMenuModal(false);
            if (e.target.id === 'joinNostrModal') toggleJoinNostrModal(false);
        });

        async function claim() {
            const npub = document.getElementById('npubInput').value.trim();
            const status = document.getElementById('status');
            const btn = document.getElementById('claimBtn');

            if (!npub.startsWith('npub1')) {
                status.innerHTML = '<div class="status error">Invalid npub</div>';
                return;
            }

            btn.disabled = true;
            status.innerHTML = '<div class="status">Sending request...</div>';

            try {
                const res = await fetch(`${FAUCET_BACKEND}/faucet`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ npub })
                });
                const data = await res.json();

                if (data.success) {
                    status.innerHTML = `<div class="status success">
                        Success! 5 NSTC sent<br>
                        <small>Event ID: ${data.eventId.substring(0,16)}...</small>
                    </div>`;
                } else {
                    status.innerHTML = `<div class="status error">${data.error || 'Request failed'}</div>`;
                }
            } catch (e) {
                status.innerHTML = '<div class="status error">Network error. Try again later.</div>';
            }
            btn.disabled = false;
        }
    </script>
</body>
</html>
